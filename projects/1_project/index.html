<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> üß† üé® 1. UMAP Visualization | üß†üè∑Ô∏è Selection of experience for memory by hippocampal sharp wave ripples </title> <meta name="author" content="Wannan (Winnie) Yang"> <meta name="description" content="Demo code to visualizae data with UMAP!"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/RippleTagging/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/RippleTagging/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/RippleTagging/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/RippleTagging/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%A7%A0%F0%9F%8F%B7%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/RippleTagging/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://winnieyangwannan.github.io/RippleTagging/projects/1_project/"> <script src="/RippleTagging/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <link defer rel="stylesheet" href="/RippleTagging/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/RippleTagging//"> üß†üè∑Ô∏è Selection of experience for memory by hippocampal sharp wave ripples </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/RippleTagging/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/RippleTagging/Paper/">Paper </a> </li> <li class="nav-item "> <a class="nav-link" href="/RippleTagging/Codes%20and%20Demos/">Codes and Demos </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">üß† üé® 1. UMAP Visualization</h1> <p class="post-description">Demo code to visualizae data with UMAP!</p> </header> <article> <p>The companion notebook will walk you through the steps of visualizing data with UMAP!</p> <p>üîó Follow the demo code in Colab Notebook <a href="https://colab.research.google.com/drive/1qwruNxqS20xIl7sXYwjUA5zXKLTMWuTz?usp=drive_link" rel="external nofollow noopener" target="_blank">here</a> ! You will learn how we generated the UMAP visualization from raw spiking data!</p> <blockquote class="block-warning"> <h5 id="note">NOTE!</h5> <p>Interactive images (black background) in this page are mostly interactive plots might take a few seconds to load! You can rotate, zoom in and play with the manifold.</p> </blockquote> <hr> <h1 id="part-1-introduction">Part 1: Introduction</h1> <p>Using dual-side silicon probe, we were able to record from many hundreds of neurons simultaneously in the dorsal CA1 region of the hippocampus while the animal perform the figure-8 maze task.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/RippleTagging/assets/img/demo/1/figure-8_trial-480.webp 480w,/RippleTagging/assets/img/demo/1/figure-8_trial-800.webp 800w,/RippleTagging/assets/img/demo/1/figure-8_trial-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/RippleTagging/assets/img/demo/1/figure-8_trial.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Fig 1. (Left) The illustration of the Figure-8 maze task, where mice alternated between left and right arms for water reward (blue droplets). The animal‚Äôs trajectory along maze corridors was color-coded by its linearized position. (Right) The running trajectories of a mouse running on the figure 8 maze, colored by trial block number. </div> <p>When we inspected single neuron activity, we found that many neurons changed their firing rates across trials. Some cells fired with higher firing rates during early trials, some fired with higher firing rate during late trials, and some cells‚Äô place field remapped across trials. The behavior of the those individual cells gave us a hint that we might be able to distinguish which trial the animal is currently at based on the different spiking patterns of the CA1 neurons across trials. Since single cell activity is noisy, we wondered if we can find a way to leverage the activity of many hundreds of cells? And if so,we might be able to accurately decode which trial the animal is currently at based on population activity rather than activities of single cells.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/RippleTagging/assets/img/demo/1/single_cell_github-480.webp 480w,/RippleTagging/assets/img/demo/1/single_cell_github-800.webp 800w,/RippleTagging/assets/img/demo/1/single_cell_github-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/RippleTagging/assets/img/demo/1/single_cell_github.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Fig 2. Spatial tuning curve of example cells. </div> <details><summary>Click here to read the full figure legend.</summary> <p>The firing rate in space (linearized position on the figure-8 maze) of 6 example neurons across different trials in one representative session. The tuning curves were color-coded by trial block number (cold color for early trials and warm color for late trials). For each example cell, its firing rates as a function of the linearized position (from 0 to 200-cm) for each of the two arms of the figure-8 maze were plotted separately. Most cells exhibited rate remapping or global remapping across the two arms of the radial arm maze.</p> <p>(A) Two example cells that fired with higher firing rates during early trials. (Left) left arm trials. (Right) right arm trials.</p> <p>(B) Two example cells that fired with higher firing rate during late trials.</p> <p>(C) Two example cells with place field remapping across trials.</p> </details> <hr> <h1 id="part-2--dimensionality-reduction">Part 2: Dimensionality Reduction</h1> <p>Humans are visual creatures. We need to see in order to believe. The dual sided probe we used for recording allows us to record up to 500 neurons simultaneously. But the large number of neurons in our data means we are dealing with high dimensional data (the number of dimension scales with the number of neurons). When we have one neuron, visualizing the activity of that single cell across time is easy ‚Äì the tuning curve in the fig. 2 above can gave us a clear picture of how individual cell activity evolve over positions across trials. But as soon as we have more than three neurons, we lost our ability to visualize the dynamics of the population in one coherent picture.</p> <p>That is where dimensionality reduction becomes handy. Dimensionality reduction is a technique used to reduce the number of features in a dataset while retaining as much of the important information as possible. In other words, it is a process of transforming high-dimensional data into a lower-dimensional space that still preserves the essence of the original data (Although some aspects of the data will be distorted during the process of course, for more discussions on this, check out our last demo).</p> <p>We used <a href="https://arxiv.org/abs/1802.03426" rel="external nofollow noopener" target="_blank">Uniform Manifold Approximation and Projection (UMAP)</a> to embed the data in a low-dimensional space. The following interactive plots were generated by running UMAP on neural data recorded from the dorsal CA1 of the hippocampus when mouse performing an alternation task on the figure-8 maze. You can play with the visualization by dragging the interactive plot and rotate it to different angles.</p> <div class="l-page"> <iframe src="/RippleTagging/assets/html/demo/umap_unsupervised_pos.html" frameborder="0" scrolling="no" height="500px" width="1000px" style="border: 1px dashed grey;"></iframe> </div> <div class="caption"> Fig 3. An <mark>interactive</mark> plot showing the UMAP embedding of the neural data when a mouse was running on the figure-8 maze. (Left) UMAP embedding of population activity. Each point corresponds to the low-dimensional representation of one binned spiking data. (Right) running trajectory of a mouse on the figure-8 maze. Both the neural manifold and the running trajectory were colored by the animal's linearized position. </div> <blockquote class="block-tip"> <h5 id="tip">TIP!</h5> <p>This is an interactive plot! You can rotate the manifold and examine the manifold from different angles!! This figure might take a few seconds to render!</p> </blockquote> <div class="l-page"> <iframe src="/RippleTagging/assets/html/demo/umap_unsupervised_trial.html" frameborder="0" scrolling="no" height="500px" width="1000px" style="border: 1px dashed grey;"></iframe> </div> <div class="caption"> Fig 4. Similar to the previous plot, this <mark>interactive</mark> plot shows the UMAP embedding of the neural data when a mouse was running on the figure-8 maze.Both the neural manifold and the running trajectory were colored by trial block number. </div> <p>As expected, UMAP visualization revealed that population activity of the hippocampus corresponded to a latent space that topologically resembled the physical environment. This visualization was beautiful yet not surprising since we know that there are place cells in the hippocampus.</p> <p>What was really surprising and unexpected was when we colored the neural manifold with trial number, we saw a prominent progression of states that corresponded to trial sequences. This means that population activity in the hippocampus indeed encode the sequence of different events!</p> <hr> <h1 id="part-3-umap-visualization-on-different-datasets">Part 3: UMAP visualization on different datasets</h1> <p>Trial specific population activity dynamics was also observed in simpler tasks like a linear maze, as well as more complex tasks like radial arm maze. Those observations suggest that the phenomenon we found is a general representation scheme used by the brain, regardless of behavioral paradigm and rodent species.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/RippleTagging/assets/img/demo/1/other_dataset-480.webp 480w,/RippleTagging/assets/img/demo/1/other_dataset-800.webp 800w,/RippleTagging/assets/img/demo/1/other_dataset-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/RippleTagging/assets/img/demo/1/other_dataset.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> fig 5. Trial-specific evolution of neuronal population activity can be observed in different tasks and rodent species. </div> <details><summary>Click here to read the figure legend</summary> <p>(A) Rat running back and forth between the two reward ports located at either end of the linear track to collect water reward (blue droplets).</p> <p>(B) Animal‚Äôs trajectory along the track was color-coded by animals‚Äô linearized position along the track. Only data when the animal‚Äôs speed was larger than 1 cm/s was included. Left, UMAP embedding of population activity, colored by the rat‚Äôs linearized position. Right, running trajectory of a rat on the linear maze.</p> <p>(C) Same session as (B) but the manifold (left) and maze trajectory (right) were colored by trial block number.</p> <p>(D) Same session as (B) and (C), but using semi-supervised UMAP trained on blocks of 5 trials. The neural manifold (left) and maze trajectory (right) were colored by trial block number.</p> <p>(E) In the radial-arm maze experiment, mouse collect water reward (blue droplets) from 3 out of the 8 potential reward sites at the end of each arm of the radial arm maze (arms 3,4 and 7 were rewarded in this example session). The animal‚Äôs trajectory along the track was color-coded by the arm‚Äôs identity.</p> <p>(F) Left, UMAP embedding of population activity, colored by animal‚Äôs linearized position on each of the 8 arms. Right, running trajectory of a mouse on the radial arm maze.</p> <p>(G) Same session as (F) but the neural manifold and maze trajectory were colored by arm identity. 0 represents the center area.(H) Since the manifold of figure-8 maze was complex, we focused only on one of the 8 arms to have a clear visualization of the state space evolution with trial number. We focused on arm 7 because the mouse visited this arm for 30 trials on this recording day. The neural manifold (left) was trained using semi-supervised UMAP on blocks of 5 trials. The manifold (left) and maze trajectory (right) were colored by trial block number.</p> </details> <hr> <h1 id="part-4-down-sampling-and-its-impact-on-neural-embedding">Part 4: Down-sampling and its impact on neural embedding</h1> <p>When we down-sampled the number of cells included for generating the UMAP embedding, we observed that the trial specific pattern degraded. When there were less than 100 cells, different trials were almost indistinguishable. This simple down-sampling analysis shows the importance of recording from large population of cells (thanks to the dual-sided probe that maximize the number of simultaneously recorded cells)!</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/RippleTagging/assets/img/demo/1/downsample-480.webp 480w,/RippleTagging/assets/img/demo/1/downsample-800.webp 800w,/RippleTagging/assets/img/demo/1/downsample-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/RippleTagging/assets/img/demo/1/downsample.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Fig 6. Manifolds generated from down-sampling the number of cells included for UMAP embedding. </div> <hr> <h1 id="part-5-why-umap">Part 5: Why UMAP?</h1> <p>At this point, you might be wondering why we use UMAP and not simple linear dimensionality reduction methods like PCA. The short answer is that PCA does not generate clear visualization in low dimensional space (3D). However, PCA can still be used for decoding if including more principle component (working in a higher dimensional space). Check out our next demo for more ciscussion!</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/RippleTagging/assets/img/demo/1/pca_umap-480.webp 480w,/RippleTagging/assets/img/demo/1/pca_umap-800.webp 800w,/RippleTagging/assets/img/demo/1/pca_umap-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/RippleTagging/assets/img/demo/1/pca_umap.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Fig 7. Comparing UMAP and PCA. (A) Low- dimensional embedding of CA1 population activity, colored by animal‚Äôs linearized position on the figure-8 maze. Top, UMAP manifold. Bottom, PCA manifold. (B) Same as (A) but colored by trial block number. embedding. </div> <hr> <h1 id="how-to-cite-us-">How to cite us ?</h1> <p>Enjoyed reading this post and found our demo code useful? It can be cited as follows:</p> <p>Wannan Yang, Chen Sun, Roman Husz√°r, Thomas Hainmueller, Kirill Kiselev, Gy√∂rgy Buzs√°ki. ‚ÄúSelection of experience for memory by hippocampal sharp wave ripple.‚Äù <em>Science</em> (2024).</p> </article> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> ¬© Copyright 2024 Wannan (Winnie) Yang. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/RippleTagging/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/RippleTagging/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/RippleTagging/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/RippleTagging/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/RippleTagging/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/RippleTagging/assets/js/common.js?da39b660470d1ba6e6b8bf5f37070b6e"></script> <script defer src="/RippleTagging/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/RippleTagging/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>